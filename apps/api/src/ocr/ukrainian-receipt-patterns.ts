/**
 * Патерни для розпізнавання українських фіскальних чеків
 */

export const UKRAINIAN_RECEIPT_PATTERNS = {
  // Патерни для магазинів
  STORE_PATTERNS: [
    /ФОП\s+[А-ЯІЇЄҐ\s\.]+/i,
    /магазин\s*[А-ЯІЇЄҐ\s\.]+/i,
    /ТОВ\s+[А-ЯІЇЄҐ\s\.]+/i,
    /ПП\s+[А-ЯІЇЄҐ\s\.]+/i,
    /Тзов\s+ТВК\s+"[А-ЯІЇЄҐ\s\.]+"/i,
    /ТВК\s+"[А-ЯІЇЄҐ\s\.]+"/i
  ],

  // Патерни для дати та часу
  DATE_PATTERNS: [
    /(\d{2}[\.\-]\d{2}[\.\-]\d{2,4})/,
    /(\d{1,2}\s+(січня|лютого|березня|квітня|травня|червня|липня|серпня|вересня|жовтня|листопада|грудня)\s+\d{4})/i
  ],

  TIME_PATTERNS: [
    /(\d{1,2}[-:]\d{2}[-:]\d{2})/,
    /(\d{1,2}\s*[-:]\s*\d{2}\s*[-:]\s*\d{2})/
  ],

  // Патерни для сум
  AMOUNT_PATTERNS: [
    /СУМА\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /РАЗОМ\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /ВСЬОГО\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /ИТОГО\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /До сплати:\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i
  ],

  // Патерни для ПДВ
  TAX_PATTERNS: [
    /ПДВ\s*[А-Я]*\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /ПДВ\s*А=20%\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /ПДВ\s*20%\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /ПДВ\s*А\s*20\.00%\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i
  ],

  // Патерни для решти
  CHANGE_PATTERNS: [
    /РЕШТА\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i,
    /ЗДАЧА\s*(\d+[\s\d]*[\.,]\d{2}|\d+)/i
  ],

  // Патерни для номеру чека
  CHECK_NUMBER_PATTERNS: [
    /ЧЕК\s*№?\s*([A-Za-z0-9]+)/i,
    /№\s*([A-Za-z0-9]+)/i,
    /Чек #\s*(\d+)/i,
    /ЧЕК\s*(\d+)/i
  ],

  // Патерни для товарів
  ITEM_PATTERNS: [
    /\d+[\.,]?\d*\s*(x|×|х)\s*\d+[\.,]\d{2}/i,
    /\d+[\.,]?\d*\s*шт\.?\s*\d+[\.,]\d{2}/i,
    /\d+[\.,]?\d*\s*(X|x)\s*\d+[\.,]\d{2}/i,
    /\d+[\.,]?\d*\s*X\s*\d+[\.,]\d{2}/i
  ],

  // Патерни для товарів без кількості (тільки назва)
  ITEM_NAME_PATTERNS: [
    /^[А-ЯІЇЄҐа-яіїєґ\s\-\/\.]+$/i
  ],

  // Патерни для суми товару
  ITEM_TOTAL_PATTERNS: [
    /(\d+[\.,]\d{2})\s*ГА$/i,
    /(\d+[\.,]\d{2})\s*A$/i,
    /(\d+[\.,]\d{2})$/i
  ],

  // Патерни для валюти
  CURRENCY_PATTERNS: [
    /UAH/i,
    /грн/i,
    /₴/,
    /гривн/i
  ]
};

/**
 * Функція для очищення тексту перед OCR
 */
export function preprocessReceiptText(text: string): string {
  return text
    .replace(/\r\n/g, '\n') // Нормалізація розривів рядків
    .replace(/\n\s*\n/g, '\n') // Видалення порожніх рядків
    .replace(/[ \t]+/g, ' ') // Заміна множинних пробілів та табуляцій на одинарні
    .trim();
}

/**
 * Функція для покращення розпізнавання цифр
 */
export function improveDigitRecognition(text: string): string {
  return text
    .replace(/[Oo]/g, '0') // Заміна O на 0
    .replace(/[Il|]/g, '1') // Заміна I, l, | на 1
    .replace(/[Ss]/g, '5') // Заміна S на 5
    .replace(/[Gg]/g, '6') // Заміна G на 6
    .replace(/[Bb]/g, '8'); // Заміна B на 8
}
