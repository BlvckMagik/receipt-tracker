# Розгортання на Vercel

## Передумови

1. **Vercel CLI** встановлений глобально:
   ```bash
   npm i -g vercel
   ```

2. **pnpm** як пакетний менеджер (вже налаштований)

## Кроки розгортання

### 1. Підготовка проекту

Переконайтеся, що у вас є всі необхідні файли:
- ✅ `vercel.json` - конфігурація Vercel
- ✅ Оновлені скрипти збірки в `package.json`
- ✅ Монорепозиторій структура з `pnpm-workspace.yaml`

### 2. Авторизація в Vercel

```bash
vercel login
```

### 3. Розгортання

#### Варіант A: Через Vercel CLI
```bash
# В кореневій папці проекту
vercel

# Для продакшн розгортання
vercel --prod
```

#### Варіант B: Через GitHub інтеграцію
1. Зайдіть на [vercel.com](https://vercel.com)
2. Натисніть "New Project"
3. Імпортуйте ваш GitHub репозиторій
4. Vercel автоматично виявить монорепозиторій структуру

### 4. Налаштування змінних середовища

У Vercel Dashboard додайте необхідні змінні середовища:

```bash
# Приклад змінних (додайте ваші)
OPENAI_API_KEY=your_openai_api_key
PORT=3001
NODE_ENV=production
```

### 5. Налаштування домену (опціонально)

1. Перейдіть до Project Settings
2. Domain → Add Domain
3. Додайте ваш домен

## Архітектура розгортання

```
┌─────────────────┐
│   Vercel Edge   │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│   Frontend      │
│   (apps/web)    │
│   React + Vite  │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│   Backend       │
│   (apps/api)    │
│   NestJS API    │
└─────────────────┘
```

## Особливості конфігурації

### vercel.json пояснення:

- **builds**: Вказує Vercel як збирати ваш проект
- **routes**: Маршрутизація запитів
  - `/api/*` → Backend API
  - `/*` → Frontend SPA (через backend)
- **installCommand**: Використовує pnpm замість npm
- **buildCommand**: Збирає обидва додатки

### Переваги такого підходу:

1. **Єдиний домен** - фронтенд і бекенд на одному домені
2. **CORS** - немає проблем з CORS
3. **Простота** - один проект в Vercel
4. **Масштабованість** - легко додавати нові сервіси

## Можливі проблеми та рішення

### Проблема: Помилка збірки
**Рішення**: Переконайтеся, що всі залежності встановлені:
```bash
pnpm install
pnpm build
```

### Проблема: API не працює
**Рішення**: Перевірте змінні середовища та маршрутизацію в `vercel.json`

### Проблема: Статичні файли не завантажуються
**Рішення**: Переконайтеся, що `outputDirectory` вказує на правильну папку

## Команди для локального тестування

```bash
# Тестування збірки
pnpm build

# Локальне тестування з Vercel CLI
vercel dev

# Перевірка конфігурації
vercel --version
```

## Підтримка

- [Vercel Docs - Monorepos](https://vercel.com/docs/concepts/projects/monorepos)
- [Vercel Docs - Configuration](https://vercel.com/docs/concepts/projects/project-configuration)
